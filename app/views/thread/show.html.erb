<% lang = session["lang"] %>
<% session["now_group"] = params[:id] %>
<% thread = Group.find(params[:id]) %>
<% thread.seen_num+=1 %>
<% thread.save %>

<div class="thread_page_num"style="display:none"id="<%= @thread_page_num.to_i %>"></div>
<div class="thread_page">
  <div class="panel-title"style="display:inline-block">
    <div class="panel-title-text">
      <div class="float_jp">
        <%= simple_format(text_url_to_link(h(thread.title_jp))) %>
      </div>
      <div class="float_en">
        <%= simple_format(text_url_to_link(h(thread.title_en))) %>
      </div>
    </div>
    <% thread.hashtags.each do |hashtag| %>
      <div class="hash_tag">
        <div class="hash_icon">
          #
        </div>
        <div class="hash_text">
          <div class="hash_jp">
            <%= simple_format(text_url_to_link(h(hashtag.hash_jp))) %>
          </div>
          <div class="hash_en">
            <%= simple_format(text_url_to_link(h(hashtag.hash_en))) %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="pvpage_head">
  </div>

  <div class="thread_all"style="padding-top:10px;">
    <div class="thread_cover_cover">
      <%= render thread.posts.first %>
      <%= render thread.posts.offset(@thread_page_num*(@page_id - 1)+1).limit(@thread_page_num) %>
    </div>
  </div>
  <div class="footer thread_footer">
    <div class="thread_post_cover">
			<div class="modal-body">
        <div class="thread_post">
          <div class="post_form_cover post_form_cover_enjp connect_btn">
            <button class="btn help_show_small"data-toggle="modal" data-target="#help_slide">
              <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
              <div class="en help_text">
                Usage
              </div>
              <div class="jp help_text">
                使い方
              </div>
            </button>
            <%= image_tag "/eng.png", class: "image" %>
            <textarea name="content"class="base_en_form connect_btn content_post form-control" rows="6"
            placeholder="&#13;&#10;This side is English form.&#13;&#10;こちらは英語投稿欄です"></textarea>
          </div>
          <div class="space_form thread_send">
            <div class="trans_cover">
              <button type="button" class="normal_button post_button btn  btn_send words_post_button"id="trans_to_en"
              name="<% if logged_in? %>logined<% end %>">
                <div class="glyphicon glyphicon-arrow-left picture_send"></div>
                <div class="button_text">
                  翻訳
                </div>
              </button>
            </div>
            <div class="trans_cover">
              <button type="button" class="normal_button post_button btn  btn_send words_post_button"id="trans_to_jp"
              name="<% if logged_in? %>logined<% end %>">
                <div class="glyphicon glyphicon-arrow-right picture_send"></div>
                <div class="button_text">
                  Trans
                </div>
              </button>
            </div>
            <!--<button type="button" class="normal_button post_button btn  btn_send words_post_button"id="trans"
            name="<% if logged_in? %>logined<% end %>">
              <div class="glyphicon glyphicon-resize-horizontal picture_send"></div>
              <div class="button_text">
                <div class="float_jp">
                  翻訳
                </div>
                <div class="right_en">
                Translate
              </div>
            </button>-->
          </div>
          <div class="post_form_cover post_form_cover_enjp">
            <%= image_tag "jap.png", class: "image" %>
            <textarea name="content"class="base_jp_form content_post form-control" rows="6"
            placeholder="&#13;&#10;This side is Japanese form.&#13;&#10;こちらは日本語投稿欄です"></textarea>
          </div>
        </div>
			</div>
      <div class="post_footer_simple">
        <div class="post_button_cover thread_send">
          <button type="button" class="normal_button post_button btn  btn_send words_post_button"id="post"
          name="<% if logged_in? %>logined<% end %>">
            <div class="glyphicon glyphicon-comment picture_send"></div>
            <div class="button_text">
              <div class="float_jp">
                投稿
              </div>
              Post
            </div>
          </button>
          <!--<button type="button" class="normal_button post_button btn  btn_send words_post_button"id="trans"
          name="<% if logged_in? %>logined<% end %>">
            <div class="glyphicon glyphicon-comment picture_send"></div>
            <div class="button_text">
              <div class="float_jp">
                翻訳
              </div>
              Translate
            </div>
          </button>-->
          <%#= form_for @post,remote: true, :html => {:class => "image_post post_button_form"} do |f| %>
          <form class="thread_image_post post_button_form">
            <label for="file_send"class="normal_button post_button image_send_button btn btn-prmary image_post_button">
              <div class="glyphicon glyphicon-picture picture_send"></div>
              <div class="button_text">
                <div class="float_jp">
                  画像
                </div>
                Image
              </div>
            </label>
            <%#= f.file_field :photo,:id => "file_send", :class => "post_file", :style => "display:none"%>
            <input type="file"id="file_send"class="post_file"style="display:none">
            <input type="hidden"id="group" name="group" value="<%= params[:id] %>">
            <%#= f.hidden_field :group_id,value: params[:id] %>
          </form>
          <%# end %>
        </div>
      </div>
    </div>
    <div class="page_button_cover">
      <% if 1 >= @page_id %>
        <div class="page_button no_push">
          <span class="glyphicon glyphicon-chevron-left"></span>
        </div>
      <% else %>
        <%= link_to("/thread/show/#{params[:id]}/#{@page_id - 1}",class:"page_button ok_push") do %>
          <span class="glyphicon glyphicon-chevron-left"></span>
        <% end %>
      <% end %>
      <% if @start_num != 1 %>
        <div class="page_button dot_show">
          ...
        </div>
      <% end %>
      <% for num in @start_num.round..@end_num.round do %>
        <% if num == @page_id.round %>
          <div class="page_button now_page">
            <%= num %>
          </div>
        <% else %>
          <%= link_to("/thread/show/#{params[:id]}/#{num}",class:"page_button") do %>
            <%= num %>
          <% end %>
        <% end %>
      <% end %>
      <% if @end_num.round != @page_num.round %>
        <div class="page_button dot_show">
          ...
        </div>
      <% end %>
      <% if @page_num.round <= @page_id.round %>
        <div class="page_button no_push">
          <span class="glyphicon glyphicon-chevron-right"></span>
        </div>
      <% else %>
        <%= link_to("/thread/show/#{params[:id]}/#{@page_id.round + 1}",class:"page_button ok_push") do %>
          <span class="glyphicon glyphicon-chevron-right"></span>
        <% end %>
      <% end %>
    </div>
  </div>
  <% if logged_in? %>
    <div class="thread_post_cover check_delete">
      <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog"style="width:90vw">
          <div class="modal-content">
            <div class="modal-body">
              <div class="explain_text">
                この投稿は削除されます。
                復元できません。
                削除しますか？
                <div class="en">
                  Your comment will be deleted.
                  It is not able to be reconstructed.
                  Do you want to delete this comment?
                </div>
              </div>
              <div class="delete_html thread_all">
              </div>
            </div>
            <div class="modal-footer">
              <%= form_tag('/delete',method: :post) do %>
                <%= hidden_field_tag :delete_id ,-1,class:"delete_id" %>
                <%= hidden_field_tag :url, request.path %>
                <button type="submit" class="btn btn-default btn_delete"id="jp">
                  <div class="float_jp">削除</div>
                  <div class="base_en">Delete</div>
                </button>
                <button type="button" class="btn btn-default btn_back" data-dismiss="modal"style="margin-right:calc(50% - 70px);">
                  <div class="float_jp">戻る</div>
                  <div class="base_en">Back</div>
                </button>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>


<% if logged_in? %>
<div class="thread_post_cover">
  <div class="modal fade" id="sampleModal-enjp" tabindex="-1">
  	<div class="modal-dialog"style="width:90vw">
  		<div class="modal-content">
  			<div class="modal-body">
          <div class="thread_post">
            <div class="post_form_cover post_form_cover_enjp connect_btn">
              <%= image_tag "/eng.png", class: "image" %>
              <textarea name="content"class="en_form connect_btn content_post form-control" rows="6"
              placeholder="&#13;&#10;This side is English form.&#13;&#10;こちらは英語投稿欄です"></textarea>
            </div>
            <div class="post_form_cover post_form_cover_enjp">
              <%= image_tag "jap.png", class: "image" %>
              <textarea name="content"class="jp_form content_post form-control" rows="6"
              placeholder="&#13;&#10;This side is Japanese form.&#13;&#10;こちらは日本語投稿欄です"></textarea>
            </div>
          </div>
          <div class="explain_text">
            <div class="en">
              ●Post it as it is →“POST”<br>
              ●Rewriting words and mistranslations  (not using translation)<br>
                →Rewrite the contents above & “POST”<br>
              ●Rewriting English words & translating it into Jp again →“BACK”<br>
            </div>
            <div class="jp">
              ●このまま投稿→「投稿」<br>
              ●誤記・誤訳を修正して投稿（翻訳を使わない）→上記を書き直す＆「投稿」<br>
              ●日本語の誤記を直して、もう一度英訳→「戻る」<br>
            </div>
            <div class="enjp">
              ●Rewriting words and mistranslations  (not using translation)<br>
                →Rewrite the contents above & “POST”
            </div>
          </div>
  			</div>
  			<div class="modal-footer">
          <button type="button" class="btn btn-default btn_send"id="enjp">
            <div class="float_jp">投稿</div>
            <div class="base_en">Post</div>
          </button>
          <button type="button" class="btn btn-default btn_back" data-dismiss="modal"style="margin-right:calc(50% - 70px);">
            <div class="float_jp">戻る</div>
            <div class="base_en">Back</div>
          </button>
  			</div>
  		</div>
  	</div>
  </div>
</div>
</div>

<% end %>
<div class="thread_post_cover">
  <div class="modal fade help_modal" id="help_slide" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <div id="carousel-example-generic" class="carousel slide"data-interval="false">
            <!-- Indicators -->
            <button type="button" class="btn btn-secondary close_button" data-dismiss="modal">
              <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            </button>

            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox">
              <div class="item active">
                <img src="/frefre_explain/post1.png">
              </div>
              <div class="item">
                <img src="/frefre_explain/post2.png">
              </div>
              <div class="item">
                <img src="/frefre_explain/post3.png">
              </div>
              <div class="item">
                <img src="/frefre_explain/post4.png">
              </div>
              <div class="item">
                <img src="/frefre_explain/post5.png">
              </div>
              <div class="item">
                <img src="/frefre_explain/post_je1.png">
              </div>
              <div class="item">
                <img src="/frefre_explain/post_je2.png">
              </div>
            </div>

            <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<button class="delete_button_destroy"style="display:none">
</button>
<% if logged_in? == true %>
  <script>
    $(document).on("click", ".delete_button_destroy", function(){
      if($(".delete_button_set").attr("id") != "<%= current_user.id %>"){
          $(".delete_button_set").removeAttr("id");
          $(".delete_button_set").attr("style","display:none");
          $(".delete_button_set").attr("class","delete_button");
      }
      else {
        $(".delete_button_set").removeAttr("id");
        $(".delete_button_set").attr("class","delete_button");
      }
    });
  </script>
<% end %>
