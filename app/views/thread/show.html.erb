

<% there_be = true %>
<% leader = User.find_by(id:@threadtype.leader_id) %>

<% thread_id = @thread.id %>


<% leader = User.find_by(id:@threadtype.leader_id) %>
<% current_user_id = -1 %>
<% if logged_in? %>
  <% current_user_id = current_user.id %>
<% end %>
<div class="profile threadtype_page">
  <div class="profile_sub"style="display:inline-block;margin-top:20px;">
    <% if @threadtype.type == "every" %>
      <div class="official_mark">
        Official / 公式
      </div>
    <% end %>
    <div class="profile_picture">
      <% if @threadtype.id == 22 %>
        <%= image_tag("group_icon/chat.png", :class => "group_img",:style => "border-radius:none") %>
      <% elsif @threadtype.id == 23 %>
        <%= image_tag("group_icon/question.png", :class => "group_img",:style => "border-radius:none") %>
      <% elsif @threadtype.id == 24 %>
        <%= image_tag("group_icon/flag1.png", :class => "group_img",:style => "border-radius:none") %>
      <% elsif @threadtype.pict.attached? %>
        <%= image_tag @threadtype.pict , :class => "group_img",:style => "border-radius:none"%>
      <% else %>
        <%= image_tag("group_icon/flag1.png", :class => "group_img",:style => "border-radius:none") %>
      <% end %>
    </div>
    <div class="profile_contents_change">
      <div class="get_user_id"id="<%= current_user_id %>"></div>
      <ul class="nav flex-column">
        <li class="nav-item profile_contents_button blue-nav <% if params[:type] == nil || params[:type] == "1" || (params[:type] == "4" && @threadtype.type == "every") %>active<% end %>">
          <%= link_to "/threadtype/show/" + @threadtype.id.to_s + "/1",class:"nav-link" do %>
            <div class="jp">
              ホーム
            </div>
            <div class="en">
              Home
            </div>
          <% end %>
        </li>
        <li class="nav-item profile_contents_button blue-nav <% if params[:type] == "2" %>active<% end %>">
          <%= link_to '/threadtype/show/'+ @threadtype.id.to_s + '/2',class:"nav-link" do %>
            <div class="jp">
              人気スレッド
            </div>
            <div class="en">
              Popular Thread
            </div>
          <% end %>
        </li>
        <li class="nav-item profile_contents_button blue-nav <% if params[:type] == "3" %>active<% end %>">
          <%= link_to '/threadtype/show/'+ @threadtype.id.to_s + '/3',class:"nav-link" do %>
            <div class="jp">
              最新スレッド
            </div>
            <div class="en">
              Latest Thread
            </div>
          <% end %>
        </li>
        <% if @threadtype.type != "every" %>
          <li class="nav-item profile_contents_button blue-nav <% if params[:type] == "4" %>active<% end %>">
            <%= link_to '/threadtype/show/'+ @threadtype.id.to_s + '/4',class:"nav-link" do %>
              <div class="jp">
                メンバー
              </div>
              <div class="en">
                Member
              </div>
            <% end %>
          </li>
        <% end %>
        <li class="nav-item profile_contents_button blue-nav <% if params[:type] == "5" %>active<% end %>">
          <%= link_to '/threadtype/show/'+ @threadtype.id.to_s + '/5',class:"nav-link" do %>
            <div class="jp">
              スレッド作成
            </div>
            <div class="en">
              Make Thread
            </div>
          <% end %>
        </li>
        <li class="nav-item profile_contents_button blue-nav <% if params[:type] == "6" %>active<% end %>">
          <%= link_to '/threadtype/show/'+ @threadtype.id.to_s + '/6',class:"nav-link" do %>
            <div class="jp">
              キーワード検索
            </div>
            <div class="en">
              Search
            </div>
          <% end %>
        </li>
      </ul>
    </div>
  </div>
  <div class="profile_main"style="margin-top:5px;">
    <div class="post_content_cover threadtype_title_show">
      <div class="post_content_position width_max">
        <div class="thread_title">
          <div class="title_padding no_inline"style="font-size: 20px!important;">
            <%= @threadtype.type_en %> / <%= @threadtype.type_jp %>
          </div>
        </div>
      </div>
    </div>
    <div class="thread_cover threadtype_cover">
      <div class="threadtype_threads">
        <ul class="nav nav-tabs title_nav" id="myTab" role="tablist">
          <li class="nav-item active green-nav width_max">
            <a class="nav-link profile_history_change2" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">
              <i class="fas fa-comment-dots"></i>
              <div class="text_cover">
                <%= @thread.title_en %> / <%= @thread.title_jp %>
              </div>
            </a>
          </li>
        </ul>
        <div class="thread_all thread_all_post"style="padding-top:10px;">
          <div class="thread_cover_cover">
            <% @thread_posts.each do |post| %>
              <%= render partial: 'posts/post' ,locals: { post:post,type:"normal"} %>
            <% end %>
          </div>
        </div>
        <div class="footer thread_footer">
          <div class="thread_page post_form_page thread_post_cover form_cover">
            <%= form_tag('/tasks/trans', remote: true ,method: :post,class: "modal-body post_trans_form search_form_top",style:"display:block") do %>
              <div class="thread_post">
                <div class="post_form_cover post_form_cover_enjp connect_btn">
                  <button type="button"class="btn help_show_small"data-toggle="modal" data-target="#help_slide">
                    <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                    <div class="en help_text">
                      Usage
                    </div>
                    <div class="jp help_text">
                      使い方
                    </div>
                  </button>
                  <%= image_tag "/eng.png", class: "image" %>

                  <%= text_area_tag :content_en,"",class:"base_en_form connect_btn content_post form-control",rows:"6",placeholder:"\r\nThis side is English form.\r\nこちらは英語投稿欄です" %>
                </div>
                <div class="space_form thread_send">
                  <div class="trans_cover">
                    <button type="button" class="normal_button post_button btn  btn_send words_post_button"id="trans_to_en"
                    name="<% if logged_in? %>logined<% end %>">
                      <div class="glyphicon glyphicon-arrow-left picture_send"></div>
                      <div class="button_text button_text_jp">
                        翻訳
                      </div>
                    </button>
                  </div>
                  <div class="trans_cover">
                    <button type="button" class="normal_button post_button btn  btn_send words_post_button"id="trans_to_jp"
                    name="<% if logged_in? %>logined<% end %>">
                      <div class="glyphicon glyphicon-arrow-right picture_send"></div>
                      <div class="button_text button_text_en">
                        Trans
                      </div>
                    </button>
                  </div>
                </div>
                <div class="post_form_cover post_form_cover_enjp">
                  <%= image_tag "jap.png", class: "image" %>
                  <%= text_area_tag :content_jp,"",class:"base_jp_form connect_btn content_post form-control",rows:"6",placeholder:"\r\nThis side is Japanese form.\r\nこちらは日本語投稿欄です" %>
                </div>
                <%= hidden_field_tag :show_class_en,"base_en_form" %>
                <%= hidden_field_tag :show_class_jp,"base_jp_form" %>
                <%= hidden_field_tag :send_time ,"1",class:"send_time" %>
                <%= hidden_field_tag :form_class ,"post_trans_form" %>
                <%= hidden_field_tag :lang ,"none", class: "lang_input" %>
                <%= submit_tag "",class:"trans_send",style:"display:none"%>
              </div>
            <% end %>
            <%= link_to "https://miraitranslate.com/",class:"mirai_logo left_logo" do %>
              Powered by MT
            <% end %>

            <%= link_to "https://miraitranslate.com/",class:"mirai_logo right_logo" do %>
              翻訳提供 未来翻訳
            <% end %>
            <div class="post_footer_simple">
              <%= text_field_tag :group_num,"" ,class: "group_num",style:"display:none",value: thread_id %>
              <div class="post_button_cover thread_send">
                <%= form_for @post,:url => {controller: "post", action: "create"}, :html => {:class => "thread_image_post post_button_form", :id => "form_input",:method => "post",enctype:"multipart/form-data"},remote:true do |form| %>
                  <%= text_field_tag :group_num,"" ,class: "group_num",style:"display:none",value: thread_id %>
                  <label for="file_send"class="normal_button post_button image_send_button btn btn-prmary image_post_button">
                    <div class="glyphicon glyphicon-picture picture_send"></div>
                    <div class="button_text">
                      <div class="float_jp">
                        画像
                      </div>
                      Image
                    </div>
                  </label>
                  <%= form.hidden_field :type, :value => "image",class:"post_type"  %>
                  <% if logged_in? %>
                    <%= form.file_field :pict,id:"file_send",class:"logined",style:"display:none" %>
                    <%= form.submit "",class:"thread_submit_image",style:"display:none" %>
                  <% else %>
                    <%= form.file_field :pict,id:"file_send",style:"display:none" %>
                  <% end %>
                <% end %>
                <%= form_with(model: @post,:url => {controller: "post", action: "create"}, local: true, class: "thread_video_post post_button_form", id: "form_input") do |form| %>
                  <%= text_field_tag :group_num,"" ,class: "group_num",style:"display:none",value: thread_id %>
                  <label for="video_send"class="normal_button post_button image_send_button btn btn-prmary image_post_button">
                    <div class="glyphicon glyphicon-facetime-video picture_send"></div>
                    <div class="button_text">
                      <div class="float_jp">
                        動画
                      </div>
                      Video
                    </div>
                  </label>

                  <%= hidden_field_tag :show_class_en,".subbase_en_form" %>
                  <%= hidden_field_tag :show_class_jp,".subbase_jp_form" %>
                  <%= hidden_field_tag :send_time ,"1",class:"send_time" %>
                  <%= hidden_field_tag :show_class ,"#video-subtitle-modal" %>
                  <%= hidden_field_tag :show_modal ,"#video-subtitle-modal" %>
                  <%= hidden_field_tag :form_class ,"thread_video_post" %>
                  <%= hidden_field_tag :form_type ,"post" %>
                  <%= hidden_field_tag :lang ,"none", class: "lang_input" %>

                  <%= form.hidden_field :type, :value => "video",class:"post_type"  %>
                  <%= form.hidden_field :subtitle_en,class:"form_subtitle_input_en" %>
                  <%= form.hidden_field :subtitle_jp,class:"form_subtitle_input_jp" %>
                  <% if logged_in? %>
                    <%= form.file_field :video,id:"video_send",class:"logined",style:"display:none" %>
                    <%= form.submit "",class:"thread_submit_video",style:"display:none" %>
                  <% else %>
                    <%= form.file_field :video,id:"video_send",style:"display:none" %>
                  <% end %>
                <% end %>
              </div>
            </div>
            <button type="button" class="normal_button post_button btn btn_send words_post_button post_footer_one"id="post"
            name="<% if logged_in? %>logined<% end %>">
              <div class="glyphicon glyphicon-comment picture_send"></div>
              <div class="button_text">
                <div class="float_jp">
                  投稿
                </div>
                Post
              </div>
            </button>
          </div>

          <%= paginate @thread_posts ,outer_window: 3%>
        </div>
      </div>

      <% if logged_in? %>
      <div class="thread_post_cover">
        <div class="modal fade" id="sampleModal-enjp" tabindex="-1">
        	<div class="modal-dialog"style="width:90vw">
        		<div class="modal-content">
        			<div class="modal-body">
                <div class="thread_post">
                  <div class="post_form_cover post_form_cover_enjp connect_btn">
                    <%= image_tag "/eng.png", class: "image" %>
                    <textarea name="content"class="en_form connect_btn content_post form-control" rows="6"
                    placeholder="\r\nThis side is English form.\r\nこちらは英語投稿欄です"></textarea>
                  </div>
                  <div class="post_form_cover post_form_cover_enjp">
                    <%= image_tag "jap.png", class: "image" %>
                    <textarea name="content"class="jp_form content_post form-control" rows="6"
                    placeholder="\r\nThis side is Japanese form.\r\nこちらは日本語投稿欄です"></textarea>
                  </div>
                </div>
                <div class="explain_text">
                  <div class="en">
                    ●Post it as it is →“POST”<br>
                    ●Rewriting words and mistranslations  (not using translation)<br>
                      →Rewrite the contents above & “POST”<br>
                    ●Rewriting English words & translating it into Jp again →“BACK”<br>
                  </div>
                  <div class="jp">
                    ●このまま投稿→「投稿」<br>
                    ●誤記・誤訳を修正して投稿（翻訳を使わない）→上記を書き直す＆「投稿」<br>
                    ●日本語の誤記を直して、もう一度英訳→「戻る」<br>
                  </div>
                  <div class="enjp">
                    ●Rewriting words and mistranslations  (not using translation)<br>
                      →Rewrite the contents above & “POST”
                  </div>
                </div>
        			</div>
        			<div class="modal-footer">
                <button type="button" class="btn btn-default btn_send"id="enjp">
                  <div class="float_jp">投稿</div>
                  <div class="base_en">Post</div>
                </button>
                <button type="button" class="btn btn-default btn_back" data-dismiss="modal"style="margin-right:calc(50% - 70px);">
                  <div class="float_jp">戻る</div>
                  <div class="base_en">Back</div>
                </button>
        			</div>
        		</div>
        	</div>
        </div>
      </div>
      <div class="thread_post_cover check_delete">
        <div class="modal fade" id="video-modal" tabindex="-1">
          <div class="modal-dialog"style="width:90vw">
            <div class="modal-content">
              <div class="modal-body">
                <div style="margin-top:30px;">
                  <video id='my-video' class='video-js video_show' controls preload='auto' width='1108' height='600'
                    poster='/' data-setup='{}'style="display:none">
                    <source src='/' class="video_show_image"type='video/mp4'>
                  </video>
                </div>
              </div>
              <div class="modal-footer"style="text-align:center">
                <button class="btn btn-default btn_delete non_add_subtitle"id="jp">
                  <div class="float_jp">字幕をつけないで投稿</div>
                  <div class="base_en">Post without subtitles</div>
                </button>
                <!--
                <button class="btn btn-default btn_delete add_subtitle_en"id="jp">
                  <div class="float_jp">字幕をつける(英語の動画)</div>
                  <div class="base_en">Add subtitles(English movie)</div>
                </button>
                <button class="btn btn-default btn_delete add_subtitle_jp"id="jp">
                  <div class="float_jp">字幕をつける(日本語の動画)</div>
                  <div class="base_en">Add subtitles(Japanese movie)</div>
                </button>
                -->
                <button class="btn btn-default btn_delete add_subtitle_self"id="jp">
                  <div class="float_jp">字幕をつける(自分で)</div>
                  <div class="base_en">Add subtitles(yourself)</div>
                </button>
                <br>
                <button type="button" class="btn btn-default btn_back" data-dismiss="modal"style="margin-right:0px;margin-top:10px">
                  <div class="float_jp">戻る</div>
                  <div class="base_en">Back</div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="thread_post_cover post_form_page">
        <div class="modal fade" id="video-subtitle-modal" tabindex="-1">
        	<div class="modal-dialog"style="width:90vw">
        		<div class="modal-content">
        			<div class="modal-body">
                <div style="margin-top:30px;">
                  <video id='my-video' class='video-js video_show' controls preload='auto' width='1108' height='600'
                    poster='/' data-setup='{}'style="display:none">
                    <source src='/' class="video_show_image"type='video/mp4'>
                  </video>
                </div>
                <%= form_tag('/tasks/trans',remote: true ,method: :post,class: "modal-body post_subtrans_form search_form_top",style:"display:block") do %>
                  <div class="thread_post jimaku_form">
                    <div class="title">
                      字幕 / Subtitle
                    </div>
                    <div class="post_form_cover post_form_cover_enjp connect_btn">
                      <%= text_area_tag :content_en,"",class:"subbase_en_form connect_btn content_post form-control",rows:"6",placeholder:"\r\nThis side is English form.\r\nこちらは英語投稿欄です" %>
                    </div>
                    <div class="space_form thread_send">
                      <div class="trans_cover">
                        <button type="button" class="normal_button post_button btn btn_send words_post_button"id="subtrans_to_en"
                        name="<% if logged_in? %>logined<% end %>">
                          <div class="glyphicon glyphicon-arrow-left picture_send"></div>
                          <div class="button_text button_text_jp">
                            翻訳
                          </div>
                        </button>
                      </div>
                      <div class="trans_cover">
                        <button type="button" class="normal_button post_button btn  btn_send words_post_button"id="subtrans_to_jp"
                        name="<% if logged_in? %>logined<% end %>">
                          <div class="glyphicon glyphicon-arrow-right picture_send"></div>
                          <div class="button_text button_text_en">
                            Trans
                          </div>
                        </button>
                      </div>
                    </div>
                    <div class="post_form_cover post_form_cover_enjp">
                      <%= text_area_tag :content_jp,"",class:"subbase_jp_form connect_btn content_post form-control",rows:"6",placeholder:"\r\nThis side is Japanese form.\r\nこちらは日本語投稿欄です" %>
                    </div>
                  </div>

                  <%= hidden_field_tag :show_class_en,"subbase_en_form" %>
                  <%= hidden_field_tag :show_class_jp,"subbase_jp_form" %>
                  <%= hidden_field_tag :send_time ,"1",class:"send_time" %>
                  <%= hidden_field_tag :form_class ,"post_subtrans_form" %>
                  <%= hidden_field_tag :lang ,"none", class: "lang_input" %>
                  <%= submit_tag "",class:"trans_send",style:"display:none"%>
                <% end %>
        			</div>
        			<div class="modal-footer"style="margin-top:10px">
                <button type="button" class="btn btn-default btn_send btn_video_send"id="enjp">
                  <div class="float_jp">投稿</div>
                  <div class="base_en">Post</div>
                </button>
                <button type="button" class="btn btn-default btn_back" data-dismiss="modal"style="margin-right:calc(50% - 70px);">
                  <div class="float_jp">戻る</div>
                  <div class="base_en">Back</div>
                </button>
        			</div>
        		</div>
        	</div>
        </div>
      </div>
      <div class="thread_post_cover check_delete">
        <div class="modal fade" id="deleteModal" tabindex="-1">
          <div class="modal-dialog"style="width:90vw">
            <div class="modal-content">
              <div class="modal-body">
                <div class="explain_text">
                  この投稿は削除されます。
                  復元できません。
                  削除しますか？
                  <div class="en">
                    Your comment will be deleted.
                    It is not able to be reconstructed.
                    Do you want to delete this comment?
                  </div>
                </div>
                <div class="delete_html thread_all thread_all_post">
                </div>
              </div>
              <div class="modal-footer">
                <% if current_user.usertype=="event" %>
                  <button class="btn btn-default btn_delete cannot_delete"id="jp">
                    <div class="float_jp">削除</div>
                    <div class="base_en">Delete</div>
                  </button>
                  <button type="button" class="btn btn-default btn_back" data-dismiss="modal"style="margin-right:calc(50% - 70px);">
                    <div class="float_jp">戻る</div>
                    <div class="base_en">Back</div>
                  </button>
                <% else %>
                  <%= form_tag('/delete',method: :post) do %>
                    <%= hidden_field_tag :delete_id ,-1,class:"delete_id" %>
                    <%= hidden_field_tag :url, request.path %>
                    <button type="submit" class="btn btn-default btn_delete"id="jp">
                      <div class="float_jp">削除</div>
                      <div class="base_en">Delete</div>
                    </button>
                    <button type="button" class="btn btn-default btn_back" data-dismiss="modal"style="margin-right:calc(50% - 70px);">
                      <div class="float_jp">戻る</div>
                      <div class="base_en">Back</div>
                    </button>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
      <% end %>

      <div class="thread_post_cover">
        <div class="modal fade help_modal" id="help_slide" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-body">
                <div id="carousel-example-generic" class="carousel slide"data-interval="false">
                  <!-- Indicators -->
                  <button type="button" class="btn btn-secondary close_button" data-dismiss="modal">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                  </button>
                  <!-- Wrapper for slides -->
                  <div class="carousel-inner" role="listbox">
                    <div class="item active">
                      <img src="/frefre_explain/post1.png">
                    </div>
                    <div class="item">
                      <img src="/frefre_explain/post2.png">
                    </div>
                    <div class="item">
                      <img src="/frefre_explain/post3.png">
                    </div>
                    <div class="item">
                      <img src="/frefre_explain/post4.png">
                    </div>
                    <div class="item">
                      <img src="/frefre_explain/post5.png">
                    </div>
                    <div class="item">
                      <img src="/frefre_explain/post_je1.png">
                    </div>
                    <div class="item">
                      <img src="/frefre_explain/post_je2.png">
                    </div>
                  </div>

                  <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                  </a>
                  <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="profile_modal">
        <div class="modal fade" id="explain_modal" tabindex="-1">
        	<div class="modal-dialog"style="width:90vw">
        		<div class="modal-content">
        			<div class="modal-body">
                <div class="post_content_cover explain"data-toggle="modal" data-target="exlain_modal">
                  <div class="post_content_position width_max_text">
                    <div class="post_content">
                      <div class="post_content_text no_inline">
                        <%= simple_format(text_url_to_link(h(@threadtype.content_en))) %>
                      </div>
                    </div>
                  </div>
                  <div class="post_content_position width_max_text">
                    <div class="post_content">
                      <div class="post_content_text no_inline">
                        <%= simple_format(text_url_to_link(h(@threadtype.content_jp))) %>
                      </div>
                    </div>
                  </div>
                </div>
        			</div>
              <div class="modal-footer follow_modal_footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                  Close / 閉じる
                </button>
              </div>
        		</div>
        	</div>
        </div>
      </div>

      <div class="profile_modal">
        <div class="modal fade" id="report_post_modal" tabindex="-1">
        	<div class="modal-dialog"style="width:90vw">
        		<div class="modal-content">
              <%= form_tag('/report/post',remote: true ,method: :post,class: "search_form_top") do %>
          			<div class="modal-body">
                  <div class="title">
                    通報の理由 / Report Reason
                  </div>
                  <%= radio_button_tag :type, 4 ,"checked"%>不適切な投稿 / Sensitive Content<br>
                  <%= radio_button_tag :type, 1 %>乗っ取られたアカウント / Hacked Account<br>
                  <%= radio_button_tag :type, 2 %>偽のアカウント / False Account<br>
                  <%= radio_button_tag :type, 3 %>その他 / Other<br>
                  <div class="title"style="margin-top:10px;margin-bottom:5px;">
                    Specific Content / 具体的な内容
                  </div>
                  <%= text_area_tag :report_content,"", class: "form-control form_input" ,placeholder:"",rows:"5" %>
          			</div>
                <div class="modal-footer follow_modal_footer">
                  <%= hidden_field_tag :report_id,"-1", class: "form-control form_input report_post_input" %>
                  <%= hidden_field_tag :thread_id,thread_id %>
                  <%= hidden_field_tag :page_id,params[:page] %>
                  <button type="submit" class="btn btn-primary report_button_submit">
                    <div class="jp">
                      送信
                    </div>
                    <div class="en">
                      Send
                    </div>
                  </button>
                  <button type="button" class="btn btn-default" data-dismiss="modal">
                    <div class="jp">
                      戻る
                    </div>
                    <div class="en">
                      Back
                    </div>
                  </button>
                </div>
              <% end %>
        		</div>
        	</div>
        </div>
      </div>
    </div>
  </div>
</div>