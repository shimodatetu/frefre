<% group = post.group %>
<% first_id = group.posts.first.id%>
<% id = params[:id] %>
<% current_user_id = -1 %>

<% if logged_in? %>
  <% current_user_id = current_user.id %>
<% end %>

<% if post.deleted %>
  <div class="thread_cover deleted_coment">
    この投稿は削除されました。<br>
    <div class="en">
      This comment is deleted.
    </div>
  </div>
<% else %>
  <div class="thread_cover"id="<%= post.id %>">
    <div class="group_user_cover">
      <div class="group_img_cover">

        <% url = "/profile" %>
        <% if logged_in? && current_user.id != post.user.id %>
          <% url = "/other_profile/#{post.user.id}" %>
        <% end %>
        <%= link_to url do %>
          <% if post.user.image == 0 %>
            <% if group.user.avater.attached? %>
              <%= image_tag group.user.avater , :class => "group_img"%>
            <% else %>
              <% if group.user.photo.nil? %>
                <%= image_tag("/userimage/user1.png", :class => "group_img") %>
              <% else %>
                <%= image_tag show_image_user_path(group.user), :class => "group_img" %>
              <% end %>
            <% end %>
          <% else %>
            <%= image_tag("/userimage/user#{post.user.image}.png", :class => "group_img") %>
          <% end %>
        <% end %>
      </div>
    </div>
    <div class="thread_content">
      <div class="post_content_cover">
        <div class="user_name">
          <% if params[:id].nil? || !logged_in? || current_user_id != post.user.id %>
            <%= link_to "/other_profile/#{post.user.id}" do %>
              <%= simple_format(text_url_to_link(h(post.user.name))) %>
            <% end %>
          <% else %>
            <%= link_to "/profile" do %>
              <%= simple_format(text_url_to_link(h(post.user.name))) %>
            <% end %>
          <% end %>
          <% if params[:id].nil? || current_user_id != post.user.id || (post.id != first_id && logged_in? && current_user_id == post.user.id)%>
            <div class="dropdown">
              <div class="dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                <div class="create_time">
                  <%= (time_ago_in_words(post.created_at)).sub(/about/, '') %>
                </div>
                <span class="caret"></span>
              </div>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <% if params[:id].nil? %>
                  <div class="one_topic delete_button_set">
                    <button type="button" class="delete_button" data-toggle="modal" data-target="#deleteModal"
                        data-whatever="<%= post.id %>">
                      <div class="jp">投稿を削除する</div>
                      Delete this comment
                    </button>
                  </div>
                  <div class="one_topic profile_button_set">
                    <%= link_to "/other_profile/#{post.user.id}" do %>
                      <div class="jp">プロフィールへ飛ぶ</div>
                      Jump to the profile.
                    <% end %>
                  </div>
                  <div class="one_topic report_button_set">
                    <button class="report_post_button none_button"id="<%= post.id %>"style="width:100%">
                      <div class="jp">この投稿を通報する。</div>
                      Report this post.
                    </button>
                  </div>
                <% else %>
                  <% if current_user_id != post.user_id %>
                    <div class="one_topic">
                      <%= link_to "/other_profile/#{post.user.id}" do %>
                        <div class="jp">プロフィールへ飛ぶ</div>
                        Jump to the profile.
                      <% end %>
                    </div>
                    <% if logged_in? %>
                      <div class="one_topic">
                        <button class="report_post_button none_button"id="<%= post.id %>"style="width:100%">
                          <div class="jp">この投稿を通報する。</div>
                          Report this post.
                        </button>
                      </div>
                    <% end %>
                  <% end %>
                  <% if post.id != first_id && logged_in? && current_user_id == post.user.id %>
                    <div class="one_topic">
                      <button type="button" class="delete_button" data-toggle="modal" data-target="#deleteModal"
                          data-whatever="<%= post.id %>">
                        <div class="jp">投稿を削除する</div>
                        Delete this comment
                      </button>
                    </div>
                  <% end %>
                <% end %>
              </ul>
            </div>
          <% end %>
        </div>
        <% if post.content_eng != nil && post.content_jap != nil && post.content_eng != "" && post.content_jap != ""%>
          <div class="post_content_position en_position">
            <% if post.id == first_id %>
              <div class="thread_title">
                <div class="title_padding no_inline">
                  <%= simple_format(text_url_to_link(h(post.group.title_en))) %>
                </div>
              </div>
            <% else %>
              <div class="title_space"></div>
            <% end %>
            <div class="post_content en_content_row">
              <div class="post_content_text">
                <%= simple_format(Rinku.auto_link(h(post.content_eng))) %>
              </div>
            </div>
          </div>
          <div class="post_content_position_space">
            <span class="slider_icon glyphicon glyphicon-resize-horizontal"></span>
          </div>
          <div class="post_content_position jp_position">
            <% if post.id == first_id %>
              <div class="thread_title">
                <div class="title_padding no_inline">
                  <%= simple_format(text_url_to_link(h(post.group.title_jp))) %>
                </div>
              </div>
            <% else %>
              <div class="title_space"></div>
            <% end %>
            <div class="post_content jp_content_row">
              <div class="post_content_text">
                <%= simple_format(Rinku.auto_link(h(post.content_jap))) %>
              </div>
            </div>
          </div>
        <% end %>
        <% if post.pict.attached? || post.video.attached? %>
          <div class="post_image_cover zoom_modal_open"data-toggle="modal" data-target="#zoom_modal">
            <% if post.pict.attached?%>
              <%= image_tag post.pict , :class => "group_img"+post.id.to_s%>
            <% elsif post.video.attached? %>
             <video id='my-video' class='video-js' controls preload='auto' width='1108' height='600'
               poster='<%= url_for(post.video) %>' data-setup='{}'>
               <source src='<%= url_for(post.video) %>' type='video/mp4'>
             </video>
             <% if post.subtitle_en != nil && post.subtitle_jp != nil && post.subtitle_en != "" && post.subtitle_jp != "" %>
               <div class="post_content_position post_subtitle_position en_position">
                 <div class="title_space"></div>
                 <div class="post_content en_content_row">
                   <div class="post_content_text">
                     <%= simple_format(Rinku.auto_link(h(post.subtitle_en))) %>
                   </div>
                 </div>
               </div>
               <div class="post_content_position_space">
                 <span class="slider_icon glyphicon glyphicon-resize-horizontal"></span>
               </div>
               <div class="post_content_position post_subtitle_position jp_position">
                 <div class="title_space"></div>
                 <div class="post_content jp_content_row">
                   <div class="post_content_text">
                     <%= simple_format(Rinku.auto_link(h(post.subtitle_jp))) %>
                   </div>
                 </div>
               </div>
             <% end %>
            <% else %>
              Picture is deleted.
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
